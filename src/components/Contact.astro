---
const turnstileSiteKey = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY ?? "your-site-key";
---

<section id="contact" class="border-t border-subtle bg-section px-6 py-16 sm:py-20 reveal" data-animate>
	<div class="mx-auto grid w-full max-w-6xl gap-8 sm:gap-10 md:grid-cols-[1fr_1.1fr] md:items-start">
		<div class="space-y-5">
			<p class="text-sm font-semibold uppercase tracking-[0.3em] text-accent">Contact</p>
			<h2 class="text-3xl font-semibold text-primary md:text-4xl">Let's build something together.</h2>
			<p class="text-base text-muted">
				Tell us about your project and goals. We will deliver a clear plan and handle the build
				end-to-end.
			</p>
			<div class="rounded-3xl border border-subtle bg-surface p-6 text-sm text-muted">
				<p class="font-semibold text-primary">What happens next</p>
				<ul class="mt-3 space-y-2">
					<li>• We review your request within 1-2 business days.</li>
					<li>• You receive a proposal with scope, timeline, and budget guidance.</li>
					<li>• We kick off with requirements and a delivery plan.</li>
				</ul>
			</div>
		</div>
		<div class="mx-auto w-full p-0 sm:p-0">
			<form id="contact-form" class="space-y-4" action="/contact" method="POST">
				<div class="grid gap-4 sm:grid-cols-2">
					<label class="text-sm uppercase tracking-[0.16em] text-muted">
						Name
						<input
							class="input-field mt-2 w-full rounded-2xl px-4 py-3 text-sm"
							name="name"
							required
							placeholder="Jane Doe"
							type="text"
						/>
					</label>
					<label class="text-sm uppercase tracking-[0.16em] text-muted">
						Email
						<input
							class="input-field mt-2 w-full rounded-2xl px-4 py-3 text-sm"
							name="email"
							required
							placeholder="you@company.com"
							type="email"
						/>
					</label>
				</div>
				<label class="text-sm uppercase tracking-[0.16em] text-muted">
					Company
					<input
						class="input-field mt-2 w-full rounded-2xl px-4 py-3 text-sm"
						name="company"
						placeholder="Company name"
						type="text"
					/>
				</label>
				<label class="text-sm uppercase tracking-[0.16em] text-muted">
					Project details
					<textarea
						class="input-field mt-2 min-h-[140px] w-full rounded-2xl px-4 py-3 text-sm"
						name="message"
						required
						placeholder="Tell us about your goals, timeline, and scope."
					></textarea>
				</label>
				<div class="turnstile-wrap rounded-2xl border border-subtle bg-surface p-4">
					<div
						class="cf-turnstile"
						data-sitekey={turnstileSiteKey}
						data-size="compact"
					></div>
					<p class="mt-2 text-xs text-muted">
						This site is protected by Cloudflare Turnstile. Replace the site key before launch.
					</p>
				</div>
				<button class="btn-primary w-full" type="submit">
					Send request
				</button>
				<p id="contact-status" class="text-sm text-muted" aria-live="polite"></p>
			</form>
		</div>
	</div>
	<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
	<script is:inline>
		const form = document.getElementById("contact-form");
		const statusEl = document.getElementById("contact-status");
		const submitButton = form?.querySelector("button[type='submit']");

		if (form && statusEl) {
			form.addEventListener("submit", async (event) => {
				event.preventDefault();
				statusEl.textContent = "Sending...";
				if (submitButton) submitButton.setAttribute("disabled", "true");

				try {
					const response = await fetch(form.action, {
						method: "POST",
						body: new FormData(form),
					});
					const data = await response.json();

					if (!response.ok) {
						throw new Error(data?.error || "Something went wrong.");
					}

					form.reset();
					statusEl.textContent = "Thanks! We'll be in touch shortly.";
				} catch (error) {
					statusEl.textContent =
						error instanceof Error ? error.message : "Unable to send your message.";
				} finally {
					if (submitButton) submitButton.removeAttribute("disabled");
				}
			});
		}
	</script>
</section>
